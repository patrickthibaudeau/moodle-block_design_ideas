{"version":3,"file":"questions.min.js","sources":["../src/questions.js"],"sourcesContent":["import Modal from 'core/modal';\nimport {get_string as getString} from 'core/str';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nexport const init = async () => {\n    document.addEventListener('click', function (event) {\n        if (event.target.classList.contains('block-design-ideas-btn-ai-call-questions')) {\n            var clickedElement = event.target;\n            var promptId = clickedElement.getAttribute('data-prompt_id');\n            var sectionId = clickedElement.getAttribute('data-topic_id');\n            var courseId = clickedElement.getAttribute('data-course_id');\n\n            var get_subjects = ajax.call([{\n                methodname: 'block_design_ideas_get_questions',\n                args: {\n                    'courseid': courseId,\n                    'promptid': promptId,\n                    'sectionid': sectionId\n                }\n            }]);\n\n            get_subjects[0].done(function (results) {\n                Modal.create({\n                    title: getString('questions_generator', 'block_design_ideas'),\n                    body: Templates.render('block_design_ideas/questions', results),\n                    large: true\n                }).then(function (modal) {\n                    modal.show();\n\n                    // Add event listener for modal close event\n                    modal.getRoot().on(Modal.events.hidden, function () {\n                        var generateButton = document.getElementById('block-design-ideas-btn-generate');\n                        if (generateButton) {\n                            generateButton.remove();\n                        }\n                    });\n\n                    setTimeout(function () {\n                        var generateButton = document.getElementById('block-design-ideas-btn-generate');\n                        generateButton.addEventListener('click', function () {\n                            var buttonText = generateButton.innerHTML;\n                            var generatedContent = document.getElementById('block-design-ideas-generated-questions');\n                            generatedContent.innerHTML = '';\n                            var content = document.getElementById('id_content').value;\n                            var questionType = document.getElementById('id_question_type').value;\n\n                            generateButton.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>';\n                            var get_questions = ajax.call([{\n                                methodname: 'block_design_ideas_generate_questions',\n                                args: {\n                                    'courseid': courseId,\n                                    'questiontype': questionType,\n                                    'content': content\n                                }\n                            }]);\n\n                            get_questions[0].done(function (results) {\n                                generateButton.innerHTML = buttonText;\n                                generatedContent.innerHTML = results.html;\n\n                                setTimeout(function () {\n                                    var selectAllCheckbox = document.getElementById('block-design-ideas-subject-select-all');\n                                    if (selectAllCheckbox) {\n                                        var checkboxes = document.querySelectorAll('.block-design-ideas-subject-select');\n                                        selectAllCheckbox.addEventListener('change', function () {\n                                            checkboxes.forEach(function (checkbox) {\n                                                checkbox.checked = selectAllCheckbox.checked;\n                                            });\n                                        });\n                                    }\n                                    var createButton = document.getElementById('block-design-ideas-btn-create-questions');\n                                    createButton.addEventListener('click', function () {\n                                        var createButtonText = createButton.innerHTML;\n                                        var selectedCheckboxes = document.querySelectorAll('.block-design-ideas-subject-select:checked');\n                                        var selectedIds = [];\n                                        selectedCheckboxes.forEach(function (checkbox) {\n                                            var gift = checkbox.getAttribute('data-gift');\n                                            selectedIds.push({question: gift});\n                                        });\n                                        createButton.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>';\n                                        selectedIds = JSON.stringify(selectedIds);\n                                        var create_questions = ajax.call([{\n                                            methodname: 'block_design_ideas_save_questions',\n                                            args: {\n                                                'question_type': questionType,\n                                                'courseid': courseId,\n                                                'questions': selectedIds\n                                            }\n                                        }]);\n\n                                        create_questions[0].done(function () {\n                                            createButton.innerHTML = createButtonText;\n                                            alert('Questions created successfully');\n                                        });\n                                    });\n                                });\n                            });\n                        });\n                    }, 1000);\n                });\n            }).fail(function () {\n                alert('An error has occurred. Cannot display data');\n            });\n        }\n    });\n};"],"names":["async","document","addEventListener","event","target","classList","contains","clickedElement","promptId","getAttribute","sectionId","courseId","ajax","call","methodname","args","done","results","create","title","body","Templates","render","large","then","modal","show","getRoot","on","Modal","events","hidden","generateButton","getElementById","remove","setTimeout","buttonText","innerHTML","generatedContent","content","value","questionType","html","selectAllCheckbox","checkboxes","querySelectorAll","forEach","checkbox","checked","createButton","createButtonText","selectedCheckboxes","selectedIds","gift","push","question","JSON","stringify","alert","fail"],"mappings":"6bAKoBA,UAChBC,SAASC,iBAAiB,SAAS,SAAUC,UACrCA,MAAMC,OAAOC,UAAUC,SAAS,4CAA6C,KACzEC,eAAiBJ,MAAMC,OACvBI,SAAWD,eAAeE,aAAa,kBACvCC,UAAYH,eAAeE,aAAa,iBACxCE,SAAWJ,eAAeE,aAAa,kBAExBG,cAAKC,KAAK,CAAC,CAC1BC,WAAY,mCACZC,KAAM,UACUJ,kBACAH,mBACCE,cAIR,GAAGM,MAAK,SAAUC,wBACrBC,OAAO,CACTC,OAAO,mBAAU,sBAAuB,sBACxCC,KAAMC,mBAAUC,OAAO,+BAAgCL,SACvDM,OAAO,IACRC,MAAK,SAAUC,OACdA,MAAMC,OAGND,MAAME,UAAUC,GAAGC,eAAMC,OAAOC,QAAQ,eAChCC,eAAiB/B,SAASgC,eAAe,mCACzCD,gBACAA,eAAeE,YAIvBC,YAAW,eACHH,eAAiB/B,SAASgC,eAAe,mCAC7CD,eAAe9B,iBAAiB,SAAS,eACjCkC,WAAaJ,eAAeK,UAC5BC,iBAAmBrC,SAASgC,eAAe,0CAC/CK,iBAAiBD,UAAY,OACzBE,QAAUtC,SAASgC,eAAe,cAAcO,MAChDC,aAAexC,SAASgC,eAAe,oBAAoBO,MAE/DR,eAAeK,UAAY,0FACPzB,cAAKC,KAAK,CAAC,CAC3BC,WAAY,wCACZC,KAAM,UACUJ,sBACI8B,qBACLF,YAIL,GAAGvB,MAAK,SAAUC,SAC5Be,eAAeK,UAAYD,WAC3BE,iBAAiBD,UAAYpB,QAAQyB,KAErCP,YAAW,eACHQ,kBAAoB1C,SAASgC,eAAe,4CAC5CU,kBAAmB,KACfC,WAAa3C,SAAS4C,iBAAiB,sCAC3CF,kBAAkBzC,iBAAiB,UAAU,WACzC0C,WAAWE,SAAQ,SAAUC,UACzBA,SAASC,QAAUL,kBAAkBK,kBAI7CC,aAAehD,SAASgC,eAAe,2CAC3CgB,aAAa/C,iBAAiB,SAAS,eAC/BgD,iBAAmBD,aAAaZ,UAChCc,mBAAqBlD,SAAS4C,iBAAiB,8CAC/CO,YAAc,GAClBD,mBAAmBL,SAAQ,SAAUC,cAC7BM,KAAON,SAAStC,aAAa,aACjC2C,YAAYE,KAAK,CAACC,SAAUF,UAEhCJ,aAAaZ,UAAY,0FACzBe,YAAcI,KAAKC,UAAUL,aACNxC,cAAKC,KAAK,CAAC,CAC9BC,WAAY,oCACZC,KAAM,eACe0B,sBACL9B,mBACCyC,gBAIJ,GAAGpC,MAAK,WACrBiC,aAAaZ,UAAYa,iBACzBQ,MAAM,mDAM3B,WAERC,MAAK,WACJD,MAAM"}