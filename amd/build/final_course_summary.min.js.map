{"version":3,"file":"final_course_summary.min.js","sources":["../src/final_course_summary.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nexport const init = async () => {\n    document.addEventListener('click', function (event) {\n\n        if (event.target.classList.contains('block-design-ideas-btn-ai-call-final-course-summary')) {\n            var clickedElement = event.target;\n            // Get the data attributes\n            var promptId = clickedElement.getAttribute('data-prompt_id');\n            var courseId = clickedElement.getAttribute('data-course_id');\n\n            ModalFactory.create({\n                title: '',\n                body: Templates.render('block_design_ideas/loader', {}),\n                large: false\n            }).then(function (modal) {\n                modal.show();\n                var loaderModal = modal;\n\n                var course_summary = ajax.call([{\n                    methodname: 'block_design_ideas_get_final_course_summary',\n                    args: {\n                        'courseid': courseId,\n                        'promptid': promptId\n                    }\n                }]);\n\n                course_summary[0].done(function (results) {\n\n                    // Close the modal\n                    loaderModal.hide();\n\n                    // Show results.generatedcontent in a modal\n                    ModalFactory.create({\n                        title: getString('final_course_summary', 'block_design_ideas'),\n                        body: Templates.render('block_design_ideas/final_course_summary', results),\n                        large: true\n                    }).then(function (modal) {\n                        // Show Modal\n                        modal.show();\n\n                        // Set a timeout so that the element can be discovered in the DOM\n                        setTimeout(function () {\n                            // When button with class block-design-ideas-btn-create-course-topics is clicked, get all\n                            // checkboxes with class block-design-ideas-topic-select and get their data attributes, put\n                            // them in an array and call the ajax function to create topics\n                            var saveFinalCourseSummaryButton = document.querySelector(\n                                '.block-design-ideas-btn-save-course-summary');\n                            saveFinalCourseSummaryButton.addEventListener('click', function () {\n                                // Hide content modal;\n                                modal.hide();\n                                // Show loader modal\n                                ModalFactory.create({\n                                    title: '',\n                                    body: Templates.render('block_design_ideas/loader', {}),\n                                    large: false\n                                }).then(function (modal) {\n                                    modal.show();\n\n                                    // Get content from element with id block-design-ideas-content\n                                    var content = document.getElementById('block-design-ideas-content');\n                                    // Call the ajax function to create topics\n                                    var create_learning_outcomes = ajax.call([{\n                                        methodname: 'block_design_ideas_save_final_course_summary',\n                                        args: {\n                                            'courseid': courseId,\n                                            'content': content.innerHTML\n                                        }\n                                    }]);\n\n                                    create_learning_outcomes[0].done(function () {\n                                        // Reload window\n                                        window.location.reload();\n                                    }).fail(function () {\n                                        alert('An error has occurred. Cannot create topics');\n                                    });\n                                });\n                            });\n\n                        }, 1000);\n                    });\n\n\n                }).fail(function () {\n                    alert('An error has occurred. Cannot display data');\n                });\n            });\n        }\n    });\n};"],"names":["async","document","addEventListener","event","target","classList","contains","clickedElement","promptId","getAttribute","courseId","create","title","body","Templates","render","large","then","modal","show","loaderModal","ajax","call","methodname","args","done","results","hide","setTimeout","querySelector","content","getElementById","innerHTML","window","location","reload","fail","alert"],"mappings":"weAKoBA,UAChBC,SAASC,iBAAiB,SAAS,SAAUC,UAErCA,MAAMC,OAAOC,UAAUC,SAAS,uDAAwD,KACpFC,eAAiBJ,MAAMC,OAEvBI,SAAWD,eAAeE,aAAa,kBACvCC,SAAWH,eAAeE,aAAa,yCAE9BE,OAAO,CAChBC,MAAO,GACPC,KAAMC,mBAAUC,OAAO,4BAA6B,IACpDC,OAAO,IACRC,MAAK,SAAUC,OACdA,MAAMC,WACFC,YAAcF,MAEGG,cAAKC,KAAK,CAAC,CAC5BC,WAAY,8CACZC,KAAM,UACUd,kBACAF,aAIL,GAAGiB,MAAK,SAAUC,SAG7BN,YAAYO,8BAGChB,OAAO,CAChBC,OAAO,mBAAU,uBAAwB,sBACzCC,KAAMC,mBAAUC,OAAO,0CAA2CW,SAClEV,OAAO,IACRC,MAAK,SAAUC,OAEdA,MAAMC,OAGNS,YAAW,WAI4B3B,SAAS4B,cACxC,+CACyB3B,iBAAiB,SAAS,WAEnDgB,MAAMS,8BAEOhB,OAAO,CAChBC,MAAO,GACPC,KAAMC,mBAAUC,OAAO,4BAA6B,IACpDC,OAAO,IACRC,MAAK,SAAUC,OACdA,MAAMC,WAGFW,QAAU7B,SAAS8B,eAAe,8BAEPV,cAAKC,KAAK,CAAC,CACtCC,WAAY,+CACZC,KAAM,UACUd,iBACDoB,QAAQE,cAIF,GAAGP,MAAK,WAE7BQ,OAAOC,SAASC,YACjBC,MAAK,WACJC,MAAM,0DAKnB,WAIRD,MAAK,WACJC,MAAM"}