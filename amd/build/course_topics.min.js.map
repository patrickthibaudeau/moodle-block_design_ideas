{"version":3,"file":"course_topics.min.js","sources":["../src/course_topics.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nexport const init = async () => {\n    document.addEventListener('click', function (event) {\n\n        if (event.target.classList.contains('block-design-ideas-btn-ai-call-course-topics')) {\n            var clickedElement = event.target;\n            // Get the data attributes\n            var promptId = clickedElement.getAttribute('data-prompt_id');\n            var numberOfTopics = clickedElement.getAttribute('data-topics');\n            var courseId = clickedElement.getAttribute('data-course_id');\n\n            ModalFactory.create({\n                title: '',\n                body: Templates.render('block_design_ideas/loader', {}),\n                large: false\n            }).then(function (modal) {\n                modal.show();\n                var loaderModal = modal;\n\n                var get_topics = ajax.call([{\n                    methodname: 'block_design_ideas_get_course_topics',\n                    args: {\n                        'courseid': courseId,\n                        'promptid': promptId,\n                        'number_of_topics': numberOfTopics\n                    }\n                }]);\n\n                get_topics[0].done(function (results) {\n\n                    // Close the modal\n                    loaderModal.hide();\n\n                    // Show results.generatedcontent in a modal\n                    ModalFactory.create({\n                        title: getString('generated_topics', 'block_design_ideas'),\n                        body: Templates.render('block_design_ideas/course_topics', results),\n                        large: true\n                    }).then(function (modal) {\n                        // Show Modal\n                        modal.show();\n                        // Set a timeout so that the element can be discovered in the DOM\n                        setTimeout(function () {\n                            // Select/Deselect the checkboxes if block-design-ideas-topic-select-all is checked\n                            var selectAllCheckbox = document.getElementById('block-design-ideas-topic-select-all');\n                            if (selectAllCheckbox) {\n                                var checkboxes = document.querySelectorAll('.block-design-ideas-topic-select');\n                                selectAllCheckbox.addEventListener('change', function () {\n                                    checkboxes.forEach(function (checkbox) {\n                                        checkbox.checked = selectAllCheckbox.checked;\n                                    });\n                                });\n                            }\n\n                            // When button with class block-design-ideas-btn-create-course-topics is clicked, get all\n                            // checkboxes with class block-design-ideas-topic-select and get their data attributes, put\n                            // them in an array and call the ajax function to create topics\n                            var createTopicsButton = document.querySelector('.block-design-ideas-btn-create-course-topics');\n                            createTopicsButton.addEventListener('click', function () {\n                                // Get data attribute replace from button\n                                var replace = createTopicsButton.getAttribute('data-replace');\n                                // Get all checkboxes with class block-design-ideas-topic-select\n                                var selectedCheckboxes = document.querySelectorAll('.block-design-ideas-topic-select:checked');\n                                var topics = [];\n                                selectedCheckboxes.forEach(function (checkbox) {\n                                    // Set data attributes name and summary for topics array\n                                    var topicName = checkbox.getAttribute('data-name');\n                                    var topicSummary = checkbox.getAttribute('data-summary');\n                                    // Add to topics array\n                                    topics.push({\n                                        name: topicName,\n                                        summary: topicSummary\n                                    });\n\n                                });\n\n                                // Convert topics array to JSON string\n                                topics = JSON.stringify(topics);\n                                // Call the ajax function to create topics\n                                var create_topics = ajax.call([{\n                                    methodname: 'block_design_ideas_create_course_topics',\n                                    args: {\n                                        'replace': replace,\n                                        'courseid': courseId,\n                                        'topics': topics\n                                    }\n                                }]);\n\n                                create_topics[0].done(function () {\n                                    // Reload window\n                                    window.location.reload();\n                                }).fail(function () {\n                                    alert('An error has occurred. Cannot create topics');\n                                });\n                            });\n\n                        }, 1000);\n                    });\n\n\n                }).fail(function () {\n                    alert('An error has occurred. Cannot display data');\n                });\n            });\n        }\n    });\n};"],"names":["async","document","addEventListener","event","target","classList","contains","clickedElement","promptId","getAttribute","numberOfTopics","courseId","create","title","body","Templates","render","large","then","modal","show","loaderModal","ajax","call","methodname","args","done","results","hide","setTimeout","selectAllCheckbox","getElementById","checkboxes","querySelectorAll","forEach","checkbox","checked","createTopicsButton","querySelector","replace","selectedCheckboxes","topics","topicName","topicSummary","push","name","summary","JSON","stringify","window","location","reload","fail","alert"],"mappings":"ieAKoBA,UAChBC,SAASC,iBAAiB,SAAS,SAAUC,UAErCA,MAAMC,OAAOC,UAAUC,SAAS,gDAAiD,KAC7EC,eAAiBJ,MAAMC,OAEvBI,SAAWD,eAAeE,aAAa,kBACvCC,eAAiBH,eAAeE,aAAa,eAC7CE,SAAWJ,eAAeE,aAAa,yCAE9BG,OAAO,CAChBC,MAAO,GACPC,KAAMC,mBAAUC,OAAO,4BAA6B,IACpDC,OAAO,IACRC,MAAK,SAAUC,OACdA,MAAMC,WACFC,YAAcF,MAEDG,cAAKC,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,UACUd,kBACAH,0BACQE,mBAIjB,GAAGgB,MAAK,SAAUC,SAGzBN,YAAYO,8BAGChB,OAAO,CAChBC,OAAO,mBAAU,mBAAoB,sBACrCC,KAAMC,mBAAUC,OAAO,mCAAoCW,SAC3DV,OAAO,IACRC,MAAK,SAAUC,OAEdA,MAAMC,OAENS,YAAW,eAEHC,kBAAoB7B,SAAS8B,eAAe,0CAC5CD,kBAAmB,KACfE,WAAa/B,SAASgC,iBAAiB,oCAC3CH,kBAAkB5B,iBAAiB,UAAU,WACzC8B,WAAWE,SAAQ,SAAUC,UACzBA,SAASC,QAAUN,kBAAkBM,kBAQ7CC,mBAAqBpC,SAASqC,cAAc,gDAChDD,mBAAmBnC,iBAAiB,SAAS,eAErCqC,QAAUF,mBAAmB5B,aAAa,gBAE1C+B,mBAAqBvC,SAASgC,iBAAiB,4CAC/CQ,OAAS,GACbD,mBAAmBN,SAAQ,SAAUC,cAE7BO,UAAYP,SAAS1B,aAAa,aAClCkC,aAAeR,SAAS1B,aAAa,gBAEzCgC,OAAOG,KAAK,CACRC,KAAMH,UACNI,QAASH,kBAMjBF,OAASM,KAAKC,UAAUP,QAEJnB,cAAKC,KAAK,CAAC,CAC3BC,WAAY,0CACZC,KAAM,SACSc,iBACC5B,gBACF8B,WAIJ,GAAGf,MAAK,WAElBuB,OAAOC,SAASC,YACjBC,MAAK,WACJC,MAAM,uDAIf,WAIRD,MAAK,WACJC,MAAM"}